<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style> 
    .form-group .error-message {
      color: red;
      margin-top: 5px;
    }
  </style>
  <link
    rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
    crossorigin="anonymous"
  />
  <script src="https://unpkg.com/sweetalert2@9/dist/sweetalert2.all.js"></script>
  <link rel="stylesheet" href="./css/main.css" />

  <title>Cadastro de Usuário</title>
</head>
<body>
  <div class="col-10 offset-1 text-center mt-5 pb-4 text-primary">
    <h1 class="mt-4">Cadastro de Usuário</h1>
    </div>
    <div class="row">
        <div
          id="loginLogo"
          class="col-6 p-4  d-flex justify-content-center"
        >
          <img src="./images/a.png" alt="Logo CPaaS" />
        </div>
        <div class="col-6 p-5">
            <form id="loginForm">
            <div class="form-group">
                <label for="name">Nome Completo</label>
                <input id="name" type="text" class="form-control" />
                <span id="name-error" class="error-message"></span>
            </div>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" class="form-control">
            </div>
            <div class="form-group">
                <label for="password">Senha:</label>
                <input type="password" id="password" class="form-control">
                <span id="password-error" class="error-message"></span>
            </div>
            <div class="form-group">
                <label for="confirm-password">Confirmar Senha:</label>
                <input type="password" id="confirm-password" class="form-control">
                <span id="confirm-password-error" class="error-message"></span>
            </div>
            <button
                type="button"
                class="btn btn-outline-primary"
                onclick="registerUser()"
            >
                Cadastrar
            </button>
            </form>
        </div>
  </div>

  <script
    src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"
  ></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/0.9.0/jquery.mask.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-firestore.js"></script>
  <script src="./js/init.js"></script>
  <script src="./js/auth.js"></script>
  <script src="./js/validation-profile.js"></script>
  <script>
    function registerUser() {
      var name = document.getElementById("name").value;
      var email = document.getElementById("email").value;
      var password = document.getElementById("password").value;
      var confirmPassword = document.getElementById("confirm-password").value;

      // Verificar se todos os campos foram preenchidos
      if (!name || !email || !password || !confirmPassword) {
        swal.fire({
          icon: "error",
          title: "Oops...",
          text: "Por favor, preencha todos os campos!",
        });
        return;
      }

      // Verificar se as senhas coincidem
      if (password !== confirmPassword) {
        swal.fire({
          icon: "error",
          title: "Oops...",
          text: "As senhas não coincidem!",
        });
        return;
      }
      if ($('.error-message').text() === '') {
        firebase
        .auth()
        .createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
          var user = userCredential.user;

          // Salvar dados do usuário no Firestore
          firebase.firestore().collection("users").doc(user.uid).set({
            name: name,
            email: email,
          })
          .then(() => {
            swal.fire({
              icon: "success",
              title: "Sucesso!",
              text: "Usuário cadastrado com sucesso!",
            })
            .then(() => {
              // Redirecionar para a página de perfil
              window.location.href = "login.html";
            });
          })
          .catch((error) => {
            swal.fire({
              icon: "error",
              title: "Oops...",
              text: "Ocorreu um erro ao salvar os dados do usuário!",
            });
          });
        })
        .catch((error) => {
          var errorCode = error.code;
          var errorMessage = error.message;
          swal.fire({
            icon: "error",
            title: "Oops...",
            text: errorMessage,
          });
        });
        }else{
            swal.fire({
            icon: "error",
            title: "Dados Incorretos!",
            text: "Verifique os dados e tente novamente!",
          });
        }

      
    }
  </script>
</body>
</html>
